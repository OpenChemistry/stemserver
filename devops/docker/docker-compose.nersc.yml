version: '2'
services:
  app-flask:
    retain_ip: true

  web-nginx:
    image: openchemistry/stemserver-nginx-nersc:latest
    labels:
      io.rancher.container.pull_image: always
      cron.schedule: 0  8  *  *  *
      cron.action: restart
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - SETUID
      - SETGID
      - NET_BIND_SERVICE
    group_add:
      - nginx
    volumes:
      - web-certs.stem:/etc/letsencrypt
      - web-certbot-webroot.stem:/data/letsencrypt
    depends_on:
      - web-client
      - app-flask
      - app-girder
      
      
volumes:
  app-assetstore.stem:
    external: true
    driver: rancher-nfs
  db-mongodb.stem:
    external: true
    driver: rancher-nfs
  app-flask.stem:
    external: true
    driver: rancher-nfs
  web-certs.stem:
    external: true
    driver: rancher-nfs
  web-certbot-webroot.stem:
    external: true
    driver: rancher-nfs
